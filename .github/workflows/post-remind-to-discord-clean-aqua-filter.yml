name: Discord reminder to clean aqua filter

on:
  workflow_dispatch:
  schedule:
    - cron: "0 21 * * 5" # ÈáëÊõúÊó•„ÅÆ21:00„Å´ÂÆüË°å

jobs:
  check-every-week:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Run on every other week
        run: |
          if [[ "${GITHUB_EVENT_NAME}" == "workflow_dispatch" ]]; then
            echo "Manual run, proceeding..."
          else
            WEEK=$(date +"%V")
            if [ $((10#$WEEK % 2)) -eq 1 ]; then
              echo "Running on odd weeks (1st, 3rd, 5th week of a month)"
              # Define the task to be run
            else
              echo "This task will not run on even weeks (2nd, 4th week of a month)"
            fi
          fi
  remind:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          python -m pip install discord.py discord-py-interactions

      - name: Notify Discord
        env:
          DISCORD_BOT_TOKEN: ${{ secrets.DISCORD_CLEAN_AQUA_WEBHOOK_URL }}
        run: |
          python post-remind-to-discord-clean-aqua-filter/main.py \
            "$DISCORD_BOT_TOKEN" \
            "üê• < AQUA„ÅÆ„Éï„Ç£„É´„Çø„ÉºÊéÉÈô§„Çí„Åô„ÇãÔæãÔæüÔæñÔºÅ @everyone" \
            "„ÅäÊéÉÈô§ÂÆå‰∫Ü" \
            "„Éï„Ç£„É´„Çø„ÉºÊéÉÈô§„ÅäÁñ≤„ÇåÊßòÔæãÔæüÔæñÔºÅ"